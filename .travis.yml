language: bash

sudo: false

services:
  - docker

env:
  - VERSION=9.0.33 TAG=jdk14-openjdk-oracle VARIANT=yum
  - VERSION=9.0.33 TAG=jdk14-openjdk-buster VARIANT=apt
  - VERSION=9.0.33 TAG=jdk14-openjdk-slim-buster VARIANT=apt
  - VERSION=9.0.33 TAG=jdk11-openjdk,jdk11 VARIANT=apt
  - VERSION=9.0.33 TAG=jdk11-openjdk-slim VARIANT=apt
  - VERSION=9.0.33 TAG=jdk11-adoptopenjdk-hotspot VARIANT=apt
  - VERSION=9.0.33 TAG=jdk11-adoptopenjdk-openj9 VARIANT=apt
  - VERSION=9.0.33 TAG=jdk11-corretto VARIANT=yum
  - VERSION=9.0.33 TAG=jdk8-openjdk,jdk8 VARIANT=apt
  - VERSION=9.0.33 TAG=jdk8-openjdk-slim VARIANT=apt
  - VERSION=9.0.33 TAG=jdk8-adoptopenjdk-hotspot VARIANT=apt
  - VERSION=9.0.33 TAG=jdk8-adoptopenjdk-openj9 VARIANT=apt
  - VERSION=9.0.33 TAG=jdk8-corretto VARIANT=yum

  - VERSION=8.5.53 TAG=jdk14-openjdk-oracle VARIANT=yum
  - VERSION=8.5.53 TAG=jdk14-openjdk-buster VARIANT=apt
  - VERSION=8.5.53 TAG=jdk14-openjdk-slim-buster VARIANT=apt
  - VERSION=8.5.53 TAG=jdk11-openjdk,jdk11 VARIANT=apt
  - VERSION=8.5.53 TAG=jdk11-openjdk-slim VARIANT=apt
  - VERSION=8.5.53 TAG=jdk11-adoptopenjdk-hotspot VARIANT=apt
  - VERSION=8.5.53 TAG=jdk11-adoptopenjdk-openj9 VARIANT=apt
  - VERSION=8.5.53 TAG=jdk11-corretto VARIANT=yum
  - VERSION=8.5.53 TAG=jdk8-openjdk,jdk8 VARIANT=apt
  - VERSION=8.5.53 TAG=jdk8-openjdk-slim VARIANT=apt
  - VERSION=8.5.53 TAG=jdk8-adoptopenjdk-hotspot VARIANT=apt
  - VERSION=8.5.53 TAG=jdk8-adoptopenjdk-openj9 VARIANT=apt
  - VERSION=8.5.53 TAG=jdk8-corretto VARIANT=yum

install:
  - git clone https://github.com/docker-library/official-images.git ~/official-images

before_script:
  - imagetag="$(echo $TAG | cut -d "," -f 1)"
  - image="samschmit/tomcat-hardened:$VERSION-$imagetag"

script:
  - |
    (
      if [[ "$VERSION" == "9.0.33" && "$TAG" == "jdk11-openjdk,jdk11" || "$VERSION" == "8.5.53" && "$TAG" == "jdk8-openjdk,jdk8" ]]; then
        ./docker.sh $VERSION $TAG $VARIANT true
      else
        ./docker.sh $VERSION $TAG $VARIANT
      fi

      ~/official-images/test/run.sh "$image"
    )
